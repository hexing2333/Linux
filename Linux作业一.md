### Linux作业一

- 学号：2018211582

- 班级：2018211314

- 姓名：李志毅

#### 一、实验准备

​		搜索含有北京PM2.5的网站，找到网址为http://www.86pm25.com/city/beijing.html，网址含有的元素如下：

<img src="C:\Users\hexing\AppData\Roaming\Typora\typora-user-images\image-20210328173940326.png" alt="image-20210328173940326" style="zoom:50%;" />

​		使用F12观察网址HTML5结构，发现我们需要的数据存放在tr和td标签中，含有监测地点，PM2.5指数，在网站上部分标签中含有需要的时间数据

<img src="C:\Users\hexing\AppData\Roaming\Typora\typora-user-images\image-20210328174045843.png" alt="image-20210328174045843" style="zoom:50%;" />



​		使用命令``wegt``将网页html5下载到服务器：

​														![image-20210326181953981](C:\Users\hexing\AppData\Roaming\Typora\typora-user-images\image-20210326181953981.png)

​		使用命令``cat``查看网页内容：

<img src="C:\Users\hexing\AppData\Roaming\Typora\typora-user-images\image-20210326182119644.png" alt="image-20210326182119644" style="zoom:67%;" />



#### 二、实验步骤

##### 	1.替换标签

​			首先观察网站结构，查找我们需要的内容，监测地点和PM2.5的数据，在HTML5中包含在标签<tr><td></td></tr>中，

![image-20210326182839448](C:\Users\hexing\AppData\Roaming\Typora\typora-user-images\image-20210326182839448.png)



​			我们使用命令

​						 							```sed -e 's/<[^<>]*>/ /g'``` 

​			将以``<``开头，中间不是``<``或``>``，后接任意长度字符串并以``>``结尾的字符串，即html5中的标签，替换成空格，替换后截图如下：

​																				![image-20210326183230903](C:\Users\hexing\AppData\Roaming\Typora\typora-user-images\image-20210326183230903.png)

![image-20210326184050180](C:\Users\hexing\AppData\Roaming\Typora\typora-user-images\image-20210326184050180.png)





##### 	2.处理日期

​			之后处理标题日期，我们需要的日期在html5文件中出现在这一行：

![image-20210326184412499](C:\Users\hexing\AppData\Roaming\Typora\typora-user-images\image-20210326184412499.png)

​			首先我们将``“年”``和``“月”``替换成最后格式中的``"-"``

​					```cat beijing.html | sed -e 's/<[^<>]*>/ /g' -e 's/[年月]/-/g```

![image-20210326184700830](C:\Users\hexing\AppData\Roaming\Typora\typora-user-images\image-20210326184700830.png)





##### 	3.处理PM2.5数据并打印

​			之后我们要将含有时间的这一行和包含PM2.5数据的行筛选出来，我们可以编写```awk```文件```flow.awk```，将含有文本``"更新："``的一行中的第一个数据和第二个	数据分别赋值给变量date和time，将含有```m³```的一行中取第一个数据``监测地点``和第三个数据``PM2.5指数``，使用``printf``语句打印数据，``flow.awk``文件内容如下：	

```

/更新：/{date=$1;time=$2;}
/m³/{
        printf("%s %s,%s,%s\n",date,time,$1,$3);
}
```

![image-20210326185242948](C:\Users\hexing\AppData\Roaming\Typora\typora-user-images\image-20210326185242948.png)





##### 	4.整理最终数据

​			最后我们整理一下这个数据，将``“更新：”``替换成空，将``“时”``替换成``“:00:00”``，将``ug/m³``替换成空，将``“日”``替换成空，使用sed语句：

​			```sed -e 's/μg.m³/ /g' -e 's/[更新：日]//g' -e 's/时/:00:00/g' |more```

​			最终的完整的命令如下：

​			```cat beijing.html | sed -e 's/<[^<>]*>/ /g' -e 's/[年月]/-/g'| awk -f flow.awk | sed -e 's/μg.m?/ /g' -e 's/[更新：日]//g' -e 's/时/:00:00/g' |more```

​			最终执行后的截图如下，包含监测时间、监测地点和监测地点的PM2.5指数，与实验要求一致

![image-20210326185619670](C:\Users\hexing\AppData\Roaming\Typora\typora-user-images\image-20210326185619670.png)





#### 三、实验问题

​			在本次实验中我遇到了以下几个问题，并最终解决了这些问题

##### 	1.网址选择问题

​			包含北京PM2.5数据的网址有很多，不同的网站的HTML5结构不同，数据包含在不同的标签内，因此选择合适的网址可以进行更简便的正则匹配，最后在	综合考虑多方面因素后，我选择了本次实验的网址，他包含本次实验所需的所有数据，并且网站结构简单，没有复杂的标签，数据集中，适合于本次实验的正则	匹配实验。

##### 	2.sed指令使用不熟练

​			在刚开始实验的时候，sed指令只在课上学习过，并跟着MOOC上的案例实验过，并没有亲自动手在Linux系统上使用过，因此在最开始处理数据时，对于	sed用于替换的用法不熟悉，容易忘记单引号等。当需要复杂的替换语句时，更需要多次观看MOOC上的内容(例如第一个sed语句，对HTML5中的标签替换)，	来写出最简洁的正则匹配语句。

##### 	3.awk文件使用不熟练

​			在进行必要的一些替换后，需要编写awk脚本用户选择并打印出我们需要的数据的行，在最开始编写时，需要选择该行中标志性的特殊词，以此定位到某一行，例如需要时间这个数据，在H5中搜寻后发现，该行中包含“更新”两个特殊的语句，可以以此为切入点拿到数据，但拿到的该行第一列数据中除了时间外还包含有“更新”两个字，同时还有多余的“日”字，这些都在awk脚本执行后再执行sed语句处理，对于包含PM2.5数据的行，我们以m³为切入点，打印每一行，并在最后使用sed语句将m³剔除。编写awk文件时，找到所需行中的特殊字符或字符串很重要。

##### 	4.命令使用不够细节

​			在第一次编写完成并测试时，我发现我筛选出的数据都显示在一行中，多个PM2.5数据并没有换行，一开始我认为可能是元HTML5文件的tr标签之间并没有换行，我使用sed语句为每个</tr>后加入了换行符，发现最终的数据依旧没有换行，经过仔细的梳理，发现了原来是awk脚本中printf语句最后没有加入换行符``\n``，这是由于实验不够细致导致的，也为我以后进行实验敲响了警钟，要细致的处理数据，耐心的找寻出现的问题并解决。



#### 四、实验总结

​			本次实验通过搜寻北京PM2.5Web网页并处理该网页上的HTML5数据，练习了正则匹配表达式的应用，本次实验让我正则表达式的运用能力得到了进一步的提升，对于sed语句和awk脚本文件的使用变得更加的熟练，对于在Linux系统上使用正则表达式处理数据有了更深的体会，从最开始使用指令都不熟悉到最后可以熟练根据文本内容分析出应该使用的语句，这次实验使我收获颇丰。